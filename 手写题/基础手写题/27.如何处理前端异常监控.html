<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>如何处理前端异常监控？
    </title>
</head>

<body>
    <div>window</div>
    <script src="http://localhost:8081/index.js" crossorigin></script>
    <!-- <img src="./images/error.jpg" /> -->
    <!-- <script>
        // try-catch只能捕获到同步运行时错误，无法捕获语法错误和异步错误。
        // console.log(what)
        try{
            console.log(what)
        }catch(e){
            console.log('捕获到异常：', e)
        }


        // 语法错误无法捕获
        // try{
        //     var err = 'jja
        // }catch(e){
        //     console.log('可以捕获到嘛')
        // }

        // 异步错误无法捕获
        try{
            setTimeout(() => {
               console.log(isisis)
            },0)
        }catch(e){
            console.log(e)
        }
    </script> -->
    <!-- <script>
        window.onerror = function(message, resource, row, col, error) {
            console.log('捕获到错误信息')
            console.log({message, resource, row, col, error})
            return true
        }
    </script> -->
    <!-- <script>
        window.addEventListener('error', function(error){
           console.log('捕获到异常错误了')
           console.log(error)
        }, true)
    </script> -->
    <!-- <script>
        window.addEventListener('unhandledrejection', function(e){
            e.preventDefault()
            console.log('捕获到异常：', e)
            return false
            
        })
        Promise.reject('jajaj')
    </script> -->

    <script>
        // while(true){
            // console.log('jjs')
        // }
        window.addEventListener('load', function () {
            sessionStorage.setItem('good_exit', 'pending');
            setInterval(function () {
                sessionStorage.setItem('time_before_crash', new Date().toString());
            }, 1000);
        });

        window.addEventListener('beforeunload', function () {
            debugger
            sessionStorage.setItem('good_exit', 'true');
        });

        if (sessionStorage.getItem('good_exit') &&
            sessionStorage.getItem('good_exit') !== 'true') {
            /*
                insert crash logging code here
            */
            alert('Hey, welcome back from your crash, looks like you crashed on: ' + sessionStorage.getItem(
                'time_before_crash'));
        }
    </script>
</body>

</html>